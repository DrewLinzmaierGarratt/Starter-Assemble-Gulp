<h1>Starter-kit for Assemble with Gulp</h1>

<p>generating webpages with Assemble-beta and Gulp</p>

<p>Assemble with Gulp is at the moment of writing not quite ready for production. When you go to <a href="https://github.com/assemble/gulp-assemble">the repo for gulp-assemble</a> you will be welcomed by a disclaimer. Things like rendering of markdown to html doesn't quite work yet, so better stay with the stable Grunt version for now. However on a small project with a Gulp workflow and markdown rendering not being required, you can give it a try.</p>

<p>The examples here are with using the beta version of Assemble <strong>not</strong> the plugin – <em>gulp-assemble</em>.</p>

<p>After <code>cd my-project</code> and <code>npm init</code> to generate your <code>package.json</code> you can follow the instructions from <a href="https://github.com/assemble/assemble#README.md">the Readme of the repo</a>.</p>

<p><strong>Install globally with <a href="npmjs.org">npm</a></strong></p>

<p><code>bash
npm i -g assemble@beta
</code></p>

<p><strong>Install locally with <a href="npmjs.org">npm</a></strong></p>

<p><code>bash
npm i assemble@beta --save
</code></p>

<p>Now you want to at least also install the <code>gulp-extname</code> plugin, to be able to dynamically rewrite file-extensions, otherwise your <code>index.hbs</code> will <em>not</em> get the <code>.html</code> extension after doing: <code>assemble</code></p>

<p><code>bash
npm i gulp-extname --save-dev
</code></p>

<p>The current workflow for this beta version is to have a seperate file for Assemble called <code>assemblefile.js</code>.</p>

<h3>Example assemblefile.js</h3>

<p>```js
var assemble = require('assemble');
var extname = require('gulp-extname');</p>

<p>assemble.option('layout', 'base');</p>

<p>assemble.partials('src/templates/partials/<em>.hbs');
assemble.layouts('src/templates/layouts/</em>.hbs');
assemble.data(['src/data/*.{json,yml}']);</p>

<p>assemble.task('default', function () {
  assemble.src('src/content/<em>*/</em>.hbs', { layout: 'base' })
    .pipe(extname())
    .pipe(assemble.dest('dist/static/'));
});
```</p>

<p>Go to the files in the repo to see about the new syntax in the <code>src/template</code> folder.
Here Assemble generates the <code>index.html</code> file unminified in the <code>dist/static/</code> folder after executing the <code>assemble</code> command on the command-line. Now we can use gulp-plugins to render and watch the <code>Sass</code> into <code>CSS</code>, have vendor prefixes automatically attached, and minify the <code>index.html</code> generated earlier by Assemble. Here I separated them out in tasks, with an added task for deployment to a gh-pages branch (only on the remote), which is generated by the <code>gulp-gh-pages</code> plugin (<em>so good</em>), one can see <a href="http://atelierbram.github.io/Starter-Assemble-Gulp/">the result here</a>.</p>

<p><code>bash
npm install --save-dev gulp-gh-pages
// Usage: Define a deploy task in your gulpfile.js (as below) which can be used to push to gh-pages going forward.
</code></p>

<h3>Example Gulpfile.js</h3>

<p>```js
var gulp = require('gulp');
var sass = require('gulp-sass');
var sourcemaps = require('gulp-sourcemaps');
var autoprefixer = require('gulp-autoprefixer');
var htmlmin = require('gulp-htmlmin');</p>

<p>var ghPages = require('gulp-gh-pages');</p>

<p>// Deploy to ghPages on GitHub with <code>gulp deploy</code>
gulp.task('deploy', function() {
  return gulp.src('dist/<em>*/</em>')
    .pipe(ghPages());
});</p>

<p>// option Vars
var srcAssets = 'src/assets/';
var distAssets = 'dist/assets/';
var sassOptions = {
  errLogToConsole: true,
  outputStyle: 'compressed'
};</p>

<p>// https://github.com/ai/browserslist#queries
var autoprefixerOptions = {
  browsers: ['last 2 versions', '> 1%', 'Firefox ESR', 'ie >= 9']
};</p>

<p>// minify html
gulp.task('minify', function() {
  return gulp.src('dist/static/*.html')
    .pipe(htmlmin({collapseWhitespace: true}))
    .pipe(gulp.dest('dist'))
});</p>

<p>// a DIY copy task, no need for a plugin with Gulp!
gulp.task('copy-js', function() {
  gulp.src('src/assets/js/*.js')
  .pipe(gulp.dest('dist/assets/js/'));
});</p>

<p>// tasks
gulp.task('sass', function () {
  return gulp
    // Find all <code>.scss</code> file from the <code>assets/sass</code> folder
    .src(srcSass)
    // Run Sass on those files
    .pipe(sass(sassOptions).on('error', sass.logError))
    .pipe(sourcemaps.write('./maps'))
    .pipe(autoprefixer(autoprefixerOptions))
    .pipe(autoprefixer())
    // write the resulting CSS in the dist-output folder for distribution
    .pipe(gulp.dest(distCss));
});</p>

<p>gulp.task('watch', function() {
  return gulp
    // Watch the Sass src folder for change,
    // and run <code>sass</code> task when something happens
    .watch(srcSass, ['sass'])
    // When there is a change,
    // log a message in the console
    .on('change', function(event) {
      console.log('File ' + event.path + ' was ' + event.type + ', running tasks...');
    });
});</p>

<p>gulp.task('default', ['sass', 'watch']);</p>

<p>```</p>

<p>In my <code>.bashrc</code> I have aliases defined for the commands which are defined above:</p>

<p><code>bash
alias gls="gulp sass"
alias glw="gulp watch"
alias gla="assemble"
alias glm="gulp minify"
alias gld="gulp deploy"
alias glcpjs="gulp copy-js"
</code></p>

<p>The assemble – and minify-task should ideally be combined into one task, but this has got to do for now.</p>

<h4>Resources</h4>

<ul>
<li><a href="https://github.com/assemble/assemble/tree/v0.6.0-dev">Assemble 6.0 dev</a></li>
<li><a href="https://github.com/jonschlinkert/gulp-extname">gulp-extname</a></li>
<li><a href="https://github.com/assemble/gulp-assemble/blob/master/gulpfile.js">example Gulpfile.js</a></li>
<li><a href="https://gist.github.com/jonschlinkert/e2da295ec7ca5d159914">example assemblefile.js</a></li>
<li><a href="https://css-tricks.com/gulp-for-beginners">Gulp for beginners</a></li>
<li><a href="http://www.sitepoint.com/simple-gulpy-workflow-sass/">A Simple Gulp’y Workflow For Sass</a></li>
<li><a href="http://ryanchristiani.com/getting-started-with-gulp-and-sass/">Getting started with Gulp and Sass</a></li>
<li><a href="http://stefanimhoff.de/2014/gulp-tutorial-4-css-generation-sass/">Introduction to Gulp.js 4: Creating CSS with Sass</a></li>
<li><a href="http://build-podcast.com/gulp/">Build Podcast</a></li>
<li><a href="http://www.mikestreety.co.uk/blog/an-advanced-gulpjs-file">Advanced Gulp File</a></li>
<li><a href="https://github.com/gulpjs/gulp/blob/master/docs/README.md#articles-and-recipes">Gulp docs on Github</a></li>
</ul>
